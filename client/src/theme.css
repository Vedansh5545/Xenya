/* ================================
   Xenya Theme — Unified (responsive + modal + motion)
   ================================ */

/* ---------- Design tokens ---------- */
:root{
  /* Core palette */
  --bg:#0D0D1A;
  --fg:#EDEDED;            /* default text */
  --text:var(--fg);
  --off:var(--fg);
  --muted:#b6b9c6;

  --violet:#7A3EFF;
  --cyan:#00E5FF;
  --rose:#FF7FBF;

  /* Surfaces & borders */
  --glass:rgba(255,255,255,.06);
  --shadow:0 0 24px rgba(122,62,255,.25);

  /* Border fallback; overridden by color-mix if supported */
  --border: rgba(122,62,255,0.35);

  /* Responsive + base font */
  --sidebar-w: clamp(220px, 24vw, 320px);
  --base-font: clamp(14px, 1.05vw + 0.2rem, 16px);

  /* Motion */
  --ease:cubic-bezier(.22,.61,.36,1);
  --t-fast:160ms; --t-med:240ms; --t-slow:320ms;
}

/* Use color-mix when available for a nicer neon border */
@supports (color: color-mix(in oklab, white, black)) {
  :root{ --border: color-mix(in oklab, var(--violet), transparent 65%); }
}

/* ---------- Resets ---------- */
*{ box-sizing:border-box }
html,body,#root{ height:100% }
html,body{ overflow:hidden } /* keep scrolling inside panes */
body{
  margin:0;
  color:var(--text);
  background:var(--bg);
  font: var(--base-font)/1.6 system-ui,"Segoe UI",Inter,Roboto,sans-serif;
}

/* ---------- Shell layout ---------- */
.shell{
  display:flex;
  height:100vh; /* internal panes scroll */
}

/* Sidebar */
.sidebar{
  flex-shrink:0;
  width:var(--sidebar-w);
  min-width:var(--sidebar-w);
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:12px;
  border-right:1px solid var(--border);
  background:linear-gradient(180deg,#0d0d1acc,#090a15cc);
  backdrop-filter: blur(6px);
  overflow:hidden; /* sidebar itself does not scroll */
}

.newchat{
  display:flex; gap:8px; align-items:center; justify-content:center;
  border:1px dashed var(--border); border-radius:12px;
  padding:10px; background:#0f1224; color:var(--fg);
  cursor:pointer
}

.modelRow{ display:flex; gap:8px; align-items:center }
.select{
  width:100%; background:#0f1224; color:var(--fg);
  border:1px solid #2a2f4a; border-radius:10px; padding:8px
}
.small{ color:var(--muted); font-size:12px }

/* Conversation list (scrolls) */
.convlist{
  flex:1; overflow:auto;
  display:flex; flex-direction:column; gap:8px;
  padding-right:4px;
}
.conv{
  position:relative; display:flex; align-items:center; justify-content:space-between; gap:8px;
  padding:10px 12px; border-radius:10px;
  background:#0f142a; border:1px solid #2a2f4a; cursor:pointer;
  transition:background var(--t-fast) var(--ease), transform var(--t-fast) var(--ease);
}
.conv.active{ outline:2px solid #7a3eff55 }
.conv-main{ display:flex; align-items:center; gap:8px; min-width:0 }
.title{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
.conv-actions{ display:flex; gap:6px; opacity:0; transition:opacity .15s ease-in-out }
.conv:hover .conv-actions{ opacity:1 }

.icon-btn{
  border:1px solid #2a2f4a; background:#171c35; color:var(--fg);
  border-radius:8px; padding:4px 8px; font-size:12px; cursor:pointer
}
.icon-btn.danger{ border-color:#80364f; background:#2a1520; color:#ffd8e6 }

/* Main area */
.main{
  flex:1; display:flex; flex-direction:column; min-width:0;
}
.header{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:12px 16px; border-bottom:1px solid var(--border);
  background:linear-gradient(180deg,#0d0d1acc,#090a15cc); backdrop-filter: blur(6px)
}
.badge{ font-size:12px; color:var(--muted) }
.header-actions{ display:none }

/* Links */
a{ color:var(--cyan); text-decoration:none }
a:hover{ text-decoration:underline }

/* ---------- Message bubbles ---------- */
.messages{
  flex:1; overflow:auto;
  padding:22px 22px 120px; /* space for composer */
  display:grid; gap:16px
}
.bubble{
  max-width:1000px;
  background:linear-gradient(to bottom right,#ffffff10,#ffffff05);
  border:1px solid var(--border);
  border-radius:18px; padding:18px; white-space:normal;
  box-shadow:0 0 0 1px #ffffff07 inset, 0 10px 20px #00000040;
  font-size:17px; line-height:1.7;
}
.user .bubble{ border-color:#273059; background:#0f142a }
.role{ font-weight:700; margin-bottom:8px }
.role.user{ color:var(--cyan) } .role.assistant{ color:var(--violet) }

/* Bubble actions */
.bubble{ position:relative }
.bubble-actions{
  position:absolute; top:10px; right:10px;
  display:flex; gap:6px;
  opacity:0; transition:opacity .15s ease-in-out;
}
.bubble:hover .bubble-actions{ opacity:1 }
/* Always show copy for assistant messages */
.assistant .bubble-actions{ opacity:1 }
.ghost-btn{
  background:#11162b; color:var(--fg);
  border:1px solid #2a2f4a; border-radius:10px;
  padding:8px 10px; cursor:pointer
}

/* Markdown typography */
.md-h1{ font-size:1.5rem; margin:.3rem 0 }
.md-h2{ font-size:1.3rem; margin:.3rem 0 }
.md-h3{ font-size:1.1rem; margin:.2rem 0 }
.md-p{  margin:.4rem 0 }
.md-ul, .md-ol{ margin:.4rem 0 .4rem 1.3rem }
.md-inline-code{
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  background:#0d1329; border:1px solid #2a2f4a; border-radius:6px; padding:2px 6px;
}

/* Code blocks + copy */
.code-block{ position:relative; margin:.6rem 0 }
.code-block pre{
  overflow:auto; padding:12px; border-radius:12px;
  background:#0d1329; border:1px solid #2a2f4a;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  font-size:14px; line-height:1.6;
}
.copy-btn{
  position:absolute; top:6px; right:6px; z-index:1;
  border:1px solid #2a2f4a; background:#171c35; color:var(--fg);
  border-radius:8px; padding:6px 8px; cursor:pointer;
}

/* ---------- Composer ---------- */
.composerWrap{
  position:fixed; left:var(--sidebar-w); right:0; bottom:0;
  padding:16px 18px;
  background:linear-gradient(180deg,transparent,#0b0e1f 40%)
}
.composer{
  max-width:980px; margin:0 auto;
  display:flex; gap:10px; align-items:center;
  background:#0f1224; border:1px solid #2a2f4a;
  border-radius:999px; padding:10px 10px 10px 16px;
  position:relative; overflow:hidden;
}
.input{ flex:1; background:transparent; color:var(--fg); border:0; outline:none; font-size:16px }

/* Buttons */
.btn{
  background:var(--violet); color:#0b0b0b;
  border:1px solid rgba(255,255,255,.06);
  padding:.6rem .9rem; border-radius:10px;
  transition:opacity var(--t-fast) var(--ease);
}
.btn:disabled{ opacity:.6; cursor:not-allowed }
.button{ /* legacy alias used in composer */
  appearance:none; border:0; border-radius:999px;
  padding:10px 16px; font-weight:700; cursor:pointer;
  background:linear-gradient(90deg,var(--violet),#6a2cff); color:#fff;
  box-shadow:0 6px 24px #7a3eff55
}
.button:disabled{ opacity:.6; cursor:not-allowed }

/* ---------- Minimalistic & private-facing helpers ---------- */
.reveal{ overflow:hidden; transition:max-height var(--t-slow) var(--ease), opacity var(--t-med) var(--ease); }
.fade-in{ animation:fadeIn var(--t-med) var(--ease) both; }
@keyframes fadeIn{ from{ opacity:0; transform:translateY(2px) } to{ opacity:1; transform:none } }

/* Loader line + error flicker */
.loader-line{
  height:2px;
  background:linear-gradient(90deg,transparent,var(--cyan),transparent);
  background-size:200% 100%;
  animation:slide 1.2s linear infinite;
}
@keyframes slide{ to{ background-position:200% 0 } }

.error-flicker{ box-shadow:0 0 18px var(--rose); animation:flicker .7s ease both; }
@keyframes flicker{ 0%,100%{ opacity:1 } 30%{ opacity:.7 } 60%{ opacity:1 } }

/* Accessibility */
:focus-visible{ outline:2px solid var(--cyan); outline-offset:2px; }
@media (prefers-reduced-motion: reduce){ *{ animation:none !important; transition:none !important } }

/* ---------- Responsive collapse: icon-only sidebar ---------- */
@media (max-width: 920px){
  :root{ --sidebar-w:72px }
  .brand h1, .conv .title, .small, .select, .modelRow svg + *:not(select){ display:none }
  .composerWrap{ left:var(--sidebar-w) }
}

/* ---------- Notes popup ---------- */
.notes-pill{
  position:fixed; top:12px; right:12px; z-index:1000;
  padding:10px 14px; border-radius:999px; border:1px solid var(--border);
  background:linear-gradient(90deg,var(--violet),#6a2cff);
  color:#fff; box-shadow:0 6px 24px #7a3eff55; cursor:pointer; font-weight:600
}
.notes-window{
  position:fixed; z-index:1000; width:340px; max-width:92vw; height:380px;
  background:linear-gradient(to bottom right,#ffffff12,#ffffff06);
  backdrop-filter: blur(8px); border:1px solid var(--border);
  border-radius:16px; box-shadow:0 0 0 1px #ffffff07 inset, 0 12px 28px #0008
}
.notes-header{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:10px 12px; border-bottom:1px solid var(--border);
  cursor:move; background:linear-gradient(180deg,#0d0d1acc,#090a15cc)
}
.notes-title{ display:flex; align-items:center; gap:8px }
.notes-sub{ color:var(--muted); font-size:12px }
.notes-eye{
  width:14px;height:14px;border-radius:50%;
  box-shadow: inset 0 0 10px var(--violet), 0 0 8px #7a3eff55
}
.notes-actions{ display:flex; gap:6px }
.notes-btn{
  background:#171c35; color:var(--fg);
  border:1px solid #2a2f4a; border-radius:8px;
  padding:6px 8px; cursor:pointer
}
.notes-body{
  padding:12px; height:calc(380px - 48px);
  overflow:auto; display:grid; gap:10px
}
.notes-body h4{ margin:0 0 6px 0; color:var(--cyan) }
.notes-body ul{ margin:0; padding-left:18px }
.notes-body li{ margin:4px 0 }
kbd{
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  padding:2px 6px; border-radius:6px;
  border:1px solid #2a2f4a; background:#0d1329
}

/* ---------- Toast ---------- */
.toast{
  position:fixed; left:50%; bottom:92px;
  transform:translateX(-50%) translateY(10px);
  background:#11162b; border:1px solid #2a2f4a;
  color:var(--fg); padding:8px 12px; border-radius:10px;
  opacity:0; transition:transform .15s ease, opacity .15s ease; z-index:1200
}
.toast.show{ opacity:1; transform:translateX(-50%) translateY(0) }

/* ---------- Modal (themed) ---------- */
.modal-backdrop{
  position:fixed; inset:0; z-index:1500;
  background:color-mix(in oklab, #000, transparent 40%);
  backdrop-filter: blur(4px);
  display:flex; align-items:center; justify-content:center;
}
.modal-card{
  width:min(480px, 92vw);
  background:linear-gradient(to bottom right,#111425ee,#0c1028ee);
  border:1px solid var(--border); border-radius:16px;
  box-shadow:0 12px 30px #0008; padding:16px; color:var(--fg)
}
.modal-head{ font-weight:700; margin-bottom:8px; color:var(--cyan) }
.modal-body{ color:var(--muted); margin-bottom:14px }
.modal-actions{ display:flex; justify-content:flex-end; gap:10px }
/* in modals, make .btn ghosty by default to avoid over-emphasis */
.modal-card .btn{
  border:1px solid #2a2f4a; background:#171c35; color:var(--fg);
}
.btn.danger{ border-color:#80364f; background:#2a1520; color:#ffd8e6 }
.btn.primary{
  background:linear-gradient(90deg,var(--violet),#6a2cff);
  border-color:transparent; color:#fff; font-weight:700
}

/* ---------- Scrollbars (WebKit) ---------- */
*::-webkit-scrollbar{ width:10px; height:10px }
*::-webkit-scrollbar-thumb{
  background:#1b2140; border:2px solid transparent; background-clip:padding-box; border-radius:10px
}
*::-webkit-scrollbar-track{ background:transparent }

/* ---------- Glass card base (alias) ---------- */
.card{
  background: var(--glass);
  border: 1px solid var(--border);
  backdrop-filter: blur(8px);
  border-radius: 16px;
  box-shadow: 0 8px 28px rgba(0,0,0,0.35);
  transition: transform var(--t-med) var(--ease), box-shadow var(--t-med) var(--ease);
}
.card:hover{ transform: translateY(-1px); }

/* ---------- Mic ring states (visual only; mic capture disabled) ---------- */
.mic{
  border:1px solid var(--violet); color:var(--off);
  background: transparent; border-radius:999px; padding:.55rem 1rem;
  transition: box-shadow .25s ease, border-color .25s ease, transform .2s ease;
}
.mic:hover{ transform: translateY(-1px); }

.mic--idle{ box-shadow: 0 0 0 0 rgba(122,62,255,.5); animation: micIdle 2.2s infinite; }
@keyframes micIdle{
  0%{ box-shadow:0 0 0 0 rgba(122,62,255,.45) }
  70%{ box-shadow:0 0 16px 8px rgba(122,62,255,.08) }
  100%{ box-shadow:0 0 0 0 rgba(122,62,255,0) }
}
.mic--listening{ border-color:var(--violet); box-shadow:0 0 18px var(--violet); animation: micListen 1.2s infinite; }
@keyframes micListen{ 0%{ box-shadow:0 0 8px var(--violet) } 50%{ box-shadow:0 0 22px var(--violet) } 100%{ box-shadow:0 0 8px var(--violet) } }
.mic--processing{ animation: micThink 1.1s linear infinite; }
@keyframes micThink{
  0%{ box-shadow:0 0 10px var(--violet), inset 0 0 10px var(--cyan) }
  50%{ box-shadow:0 0 18px var(--cyan), inset 0 0 18px var(--violet) }
  100%{ box-shadow:0 0 10px var(--violet), inset 0 0 10px var(--cyan) }
}
.mic--done{ box-shadow:0 0 22px var(--cyan); }
.mic--error{ box-shadow:0 0 16px var(--rose); animation: micError .8s ease 0s 1; }
@keyframes micError{ 0%{ box-shadow:0 0 0 var(--rose) } 30%{ box-shadow:0 0 22px var(--rose) } 100%{ box-shadow:0 0 8px rgba(122,62,255,.25) } }

/* ===== Holographic Data Terminal additions ===== */

/* Starfield parallax (ultra-light, pseudo-elements) */
body::before, body::after{
  content:""; position:fixed; inset:0; pointer-events:none; z-index:-1;
}
body::before{
  /* near layer */
  box-shadow:
    10vw 20vh 1px rgba(255,255,255,.12),
    50vw 70vh 1px rgba(255,255,255,.10),
    80vw 15vh 1px rgba(255,255,255,.08),
    30vw 90vh 1px rgba(255,255,255,.06),
    60vw 50vh 1px rgba(255,255,255,.09);
  animation: starsA 60s linear infinite;
}
body::after{
  /* far layer */
  box-shadow:
    15vw 30vh 1px rgba(255,255,255,.06),
    70vw 80vh 1px rgba(255,255,255,.05),
    25vw 65vh 1px rgba(255,255,255,.04),
    85vw 40vh 1px rgba(255,255,255,.05);
  animation: starsB 120s linear infinite;
}
@keyframes starsA{ to{ transform: translateY(-80px) } }
@keyframes starsB{ to{ transform: translateY(-40px) } }

/* Sidebar — active violet strip, hover glow, appear animation */
.conv.active{ background-color: rgba(122,62,255,0.10); }
.conv.active::before{
  content:""; position:absolute; left:-1px; top:8px; bottom:8px; width:2px; border-radius:2px;
  background: var(--violet); box-shadow:0 0 12px rgba(122,62,255,.5);
}
.conv:hover{ background-color: rgba(122,62,255,0.16); transform: translateY(-1px); }
.conv.appear{ animation: appearDown .28s var(--ease) both; }
@keyframes appearDown{ from{ opacity:0; transform: translateY(-6px) } to{ opacity:1; transform:none } }

/* Cards — assistant/user borders + “materialize”
   Softer glow to avoid stacking glare */
.assistant .bubble{
  background: rgba(237,237,237,0.05);
  border: 1px solid var(--cyan);
  box-shadow: 0 0 12px rgba(0,229,255,0.16), 0 0 0 1px rgba(255,255,255,0.05) inset;
  backdrop-filter: blur(12px);
}
.user .bubble{
  border: 1px solid var(--violet);
  box-shadow: 0 0 12px rgba(122,62,255,0.20), 0 0 0 1px rgba(255,255,255,0.04) inset;
}
.materialize{ opacity:0; transform: translateY(10px) scale(.995); animation: materialize .42s ease-out forwards; }
@keyframes materialize{ to{ opacity:1; transform: none } }

/* Thinking indicator (minimal) */
.thinking{ display:inline-flex; gap:6px; align-items:center; padding:10px 12px;
  border-radius:10px; border:1px solid var(--cyan); background: rgba(237,237,237,0.04);
  box-shadow: 0 0 15px rgba(0,229,255,0.12);
}
.dot{ width:6px; height:6px; border-radius:50%; background: var(--cyan); opacity:.6; }
.dot:nth-child(1){ animation: pulse 1.2s ease-in-out infinite }
.dot:nth-child(2){ animation: pulse 1.2s .2s ease-in-out infinite }
.dot:nth-child(3){ animation: pulse 1.2s .4s ease-in-out infinite }
@keyframes pulse{ 0%,100%{ transform:scale(1); opacity:.4 } 50%{ transform:scale(1.6); opacity:1 } }

/* Input bar — focus glow + busy sweep + done flash */
.composer:focus-within{ box-shadow:0 0 0 1px var(--violet) inset, 0 0 20px rgba(122,62,255,.25); }
.composer.is-busy::before{
  content:""; position:absolute; left:0; right:0; top:0; height:2px;
  background: linear-gradient(90deg, transparent, var(--cyan), transparent);
  background-size: 200% 100%; animation: sweep 1.2s linear infinite;
}
@keyframes sweep{ to{ background-position:200% 0 } }
.composer.done::before{
  content:""; position:absolute; left:0; right:0; top:0; height:2px; background: var(--cyan);
  animation: doneflash .5s ease both;
}
@keyframes doneflash{ from{ opacity:0 } 30%{ opacity:1 } to{ opacity:0 } }

/* Report card (/research, URL) + citation pills */
.report-card{
  background: var(--glass);
  border: 1px solid var(--cyan);
  backdrop-filter: blur(8px);
  border-radius: 16px;
  box-shadow: 0 8px 28px rgba(0,0,0,0.35);
  padding:14px;
}
.report-head{ display:flex; align-items:center; gap:10px; font-weight:700; color:var(--cyan); margin-bottom:6px }
.report-body{ color:var(--fg) }
.cites{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px }
.pill{
  display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
  background:#11162b; border:1px solid #2a2f4a; color:var(--fg); font-size:12px;
  transition: box-shadow var(--t-fast) var(--ease), transform var(--t-fast) var(--ease);
  max-width:220px;
}
.pill:hover{ box-shadow:0 0 14px rgba(255,127,191,.35); transform: translateY(-1px); }
.pill img{ width:14px; height:14px; border-radius:3px }
.pill .pill-text{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

/* Dispatch card (RSS) */
.dispatch{
  background: var(--glass);
  border: 1px solid var(--border);
  backdrop-filter: blur(8px);
  border-radius: 16px;
  box-shadow: 0 8px 28px rgba(0,0,0,0.35);
  padding:12px;
}
.dispatch h4{ margin:0 0 8px 0; color:var(--violet) }
.dispatch .item{ display:grid; grid-template-columns: auto 1fr auto; gap:8px; align-items:center; padding:6px 0; border-bottom:1px solid #1a1f38 }
.dispatch .item:last-child{ border-bottom:0 }
.dispatch .src{ color:var(--violet); font-weight:600; font-size:12px }
.dispatch .ttl{ color:var(--fg) }
.dispatch .ago{ color:var(--muted); font-size:12px; text-align:right }


/* =================================================== */
/* === Sovereign's Mark Logo + Wordmark Polish === */
/* =================================================== */
/* ===== Xenya Dual-Ring Logo (neon persists + global glow when lit) ===== */
.xenya-logo{ display:inline-flex; align-items:center; gap:12px }
.xenya-logo .eye{ display:inline-block; position:relative }
.xenya-logo svg{ display:block }

/* Visual polish */
.xenya-logo .ring-outer{ filter: drop-shadow(0 0 6px rgba(122,62,255,.28)) }

/* Base state: inner neon is UNDRAWN (hidden) */
.xenya-logo .ring-inner{
  filter: drop-shadow(0 0 8px rgba(0,229,255,.30));
  stroke-dasharray: var(--neon-circ);
  stroke-dashoffset: var(--neon-circ);
  transform-box: fill-box; transform-origin: 50% 50%;
}

/* When lit, keep ring visible forever and glow the whole logo */
.xenya-logo.logo-lit .ring-inner{ stroke-dashoffset: 0 }
.xenya-logo.logo-lit{
  filter:
    drop-shadow(0 8px 24px rgba(122,62,255,.22))
    drop-shadow(0 0 18px rgba(0,229,255,.12));
}

/* One-shot draw animation (clockwise); JS swaps classes to leave it lit */
@keyframes neonDraw { to { stroke-dashoffset: 0; } }
.xenya-logo.logo-burst .ring-inner{
  animation: neonDraw 1.15s cubic-bezier(.22,.61,.36,1) 1 forwards;
}

/* Wordmark (optional) */
.xenya-word{
  font-weight: 900; letter-spacing: .3px; line-height: 1;
  font-size: clamp(1.05rem, 0.95rem + 0.25vw, 1.25rem);
  color: var(--off);
  text-shadow: 0 2px 14px rgba(122,62,255,.22);
  -webkit-font-smoothing: antialiased; text-rendering: geometricPrecision;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  .xenya-logo .ring-inner{ animation: none !important }
}
/* ===== Composer: neon shell that matches the logo, no inner cyan focus ===== */
.composer{
  max-width: 980px; margin: 0 auto;
  display:flex; gap:10px; align-items:center;
  background:#0f1224;
  border:1px solid color-mix(in oklab, var(--violet), transparent 50%);
  border-radius:999px; padding:10px 10px 10px 16px;
  box-shadow: 0 6px 24px rgba(122,62,255,.22);
  transition: box-shadow .24s var(--ease), border-color .24s var(--ease);
}
.composer.is-focus{
  border-color: color-mix(in oklab, var(--violet), white 10%);
  box-shadow:
    0 8px 30px rgba(122,62,255,.28),
    0 0 22px rgba(0,229,255,.12);
}
.composer .input{
  flex:1; background:transparent; color:var(--fg);
  border:0; outline:none; font-size:16px;
}
/* override global focus outline for input specifically */
.composer .input:focus,
.composer .input:focus-visible{ outline:none !important }

/* Mic button fits the pill style */
.composer .mic{
  background:linear-gradient(90deg,var(--violet),#6a2cff);
  color:#fff; font-weight:700;
  border:0; border-radius:999px; padding:10px 14px; cursor:pointer;
  box-shadow:0 6px 20px rgba(122,62,255,.35);
  transition: transform .12s ease, box-shadow .18s ease;
}
.composer .mic:hover{ transform: translateY(-1px) }
.composer .mic.listening{
  box-shadow:0 0 0 0 rgba(122,62,255,.4);
  animation: micGlow 1.9s infinite;
}
@keyframes micGlow{
  0%{ box-shadow:0 0 0 0 rgba(122,62,255,.38) }
  70%{ box-shadow:0 0 18px 8px rgba(122,62,255,.10) }
  100%{ box-shadow:0 0 0 0 rgba(122,62,255,0) }
}
/* ================ chatbox ===========================*/
/* ======== ChatBox (fixed footer) ======== */
.cbx-wrap{
  position:fixed; left:var(--sidebar-w); right:0; bottom:0;
  padding:16px 18px; z-index:10;
  background:linear-gradient(180deg,transparent,#0b0e1f 40%);
}

.cbx{
  max-width: 980px; margin: 0 auto;
  position:relative;
  display:flex; align-items:center; gap:10px;
  background:#0f1224; border:1px solid #2a2f4a;
  border-radius:999px; padding:10px 10px 10px 16px;
  box-shadow: 0 12px 40px rgba(0,0,0,.45), 0 0 0 1px rgba(122,62,255,.15) inset;
}
.cbx.is-busy{ box-shadow: 0 12px 40px rgba(0,0,0,.45), 0 0 0 1px rgba(122,62,255,.28) inset; }

.cbx-input{
  flex:1; background:transparent; color:var(--fg,#EDEDED);
  border:0; outline:none; font-size:16px;
}

/* Buttons */
.cbx-actions{ display:flex; gap:10px; }
.cbx-btn{
  appearance:none; border:0; border-radius:999px;
  padding:10px 16px; font-weight:700; cursor:pointer;
  color:#fff; display:flex; align-items:center; gap:8px;
  transition: transform .15s ease, box-shadow .2s ease, opacity .15s ease;
}
.cbx-btn:disabled{ opacity:.6; cursor:not-allowed }
.cbx-btn.talk{
  background: radial-gradient(60% 100% at 30% 30%, #8c4bff 0%, #6a2cff 60%) ;
  box-shadow: 0 8px 28px rgba(122,62,255,.45);
}
.cbx-btn.talk.active{
  box-shadow: 0 0 22px #7A3EFF, inset 0 0 12px #7A3EFF;
}
.cbx-btn.send{
  background: linear-gradient(90deg,var(--violet,#7A3EFF),#6a2cff);
  box-shadow:0 8px 28px rgba(122,62,255,.35);
}

/* Waves bar INSIDE chat box */
.cbx-waves{
  position:absolute; left:14px; right:170px; top:-14px; height:10px;
  border-radius:999px;
  overflow:hidden; pointer-events:none; opacity:0; transform: translateY(6px);
  transition: opacity .25s var(--ease), transform .25s var(--ease);
  background: linear-gradient(90deg, transparent, rgba(0,229,255,.18), transparent);
}
.cbx-waves::before, .cbx-waves::after{
  content:""; position:absolute; inset:0;
  background-size: 40px 10px; opacity:.85;
}

/* Listening — soft twin waves */
.cbx-waves.listening{
  opacity:1; transform:none;
  box-shadow: 0 0 0 1px rgba(0,229,255,.25) inset, 0 0 26px rgba(122,62,255,.35);
}
.cbx-waves.listening::before{
  background-image:
    repeating-linear-gradient(90deg, rgba(0,229,255,.55) 0 14px, transparent 14px 40px);
  animation: cbxSlide 1.1s linear infinite;
}
.cbx-waves.listening::after{
  background-image:
    repeating-linear-gradient(90deg, rgba(122,62,255,.45) 0 10px, transparent 10px 40px);
  animation: cbxSlide 1.6s linear infinite reverse;
}

/* Transcribing — tighter cyan bands */
.cbx-waves.transcribing{
  opacity:1; transform:none;
  box-shadow: 0 0 0 1px rgba(0,229,255,.25) inset, 0 0 22px rgba(0,229,255,.35);
}
.cbx-waves.transcribing::before{
  background-image:
    repeating-linear-gradient(90deg, rgba(0,229,255,.7) 0 8px, transparent 8px 28px);
  animation: cbxSlide 0.8s linear infinite;
}
.cbx-waves.transcribing::after{
  background-image:
    repeating-linear-gradient(90deg, rgba(122,62,255,.35) 0 6px, transparent 6px 28px);
  animation: cbxSlide 1.1s linear infinite reverse;
}

/* Thinking — calm single cyan sweep */
.cbx-waves.thinking{
  opacity:1; transform:none;
}
.cbx-waves.thinking::before{
  background-image:
    repeating-linear-gradient(90deg, rgba(0,229,255,.4) 0 18px, transparent 18px 48px);
  animation: cbxSlide 1.4s linear infinite;
}
.cbx-waves.thinking::after{ display:none }

/* Speaking — violet glow pulse */
.cbx-waves.speaking{
  opacity:1; transform:none;
  box-shadow: 0 0 0 1px rgba(122,62,255,.25) inset, 0 0 26px rgba(122,62,255,.45);
}
.cbx-waves.speaking::before{
  background-image:
    repeating-linear-gradient(90deg, rgba(122,62,255,.6) 0 16px, transparent 16px 46px);
  animation: cbxSlide 1.2s linear infinite;
}
.cbx-waves.speaking::after{ display:none }

@keyframes cbxSlide{ to { background-position: 40px 0 } }

/* Mobile collapse still respected */
@media (max-width: 920px){
  .cbx-wrap{ left:var(--sidebar-w) }
}
/* --- Composer wave-in-input ------------------------------------------------ */
.composer { position: relative; }
.composer.is-focus .input { box-shadow: none !important; border: 0 !important; } /* kill inner neon line */
.composer .input { outline: 0; }

/* Wave container sits over the input, only when mode !== idle */
.voice-wave{
  position:absolute; left:16px; right:190px; top:50%;
  transform:translateY(-50%);
  height:28px; display:flex; gap:6px; pointer-events:none;
  filter: drop-shadow(0 0 10px rgba(0,229,255,.25));
}
.voice-wave span{
  width:6px; border-radius:3px;
  transform-origin:center bottom;
  animation: xWave 1.2s ease-in-out infinite;
  opacity:.95;
}

/* Modes (color + glow) */
.voice-wave.listening span{
  background: var(--cyan);
  box-shadow: 0 0 14px #00E5FF66;
}
.voice-wave.transcribing span{
  background: linear-gradient(to bottom, var(--violet), var(--cyan));
  box-shadow: 0 0 14px #7A3EFF55;
}
.voice-wave.processing span{
  background: color-mix(in oklab, var(--violet) 70%, var(--cyan));
  box-shadow: 0 0 12px #7A3EFF44;
  opacity:.8;
}

@keyframes xWave{
  0%   { transform: scaleY(.25) }
  40%  { transform: scaleY(1.00) }
  60%  { transform: scaleY(.55) }
  100% { transform: scaleY(.25) }
}

/* Keep overall glow coherent with your logo theme */
.composer.show-wave{
  box-shadow: 0 0 0 1px color-mix(in oklab, var(--violet), transparent 60%) inset,
              0 0 24px rgba(122,62,255,.22), 0 10px 28px rgba(0,0,0,.35);
}

/* Tweak spacing at very narrow widths so wave doesn't collide with buttons */
@media (max-width: 520px){
  .voice-wave{ right: 156px }
}
/* ===== ChatBox (composer) ================================================= */
.chatbox-wrap{
  position: sticky;
  bottom: 18px;
  z-index: 5;
  display: flex;
  justify-content: center;
  padding: 0 18px;
}
.chatbox{
  position: relative;
  width: min(1100px, 92vw);
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  gap: 12px;
  padding: 14px 14px 14px 18px;
  border-radius: 26px;
  background: linear-gradient(180deg, rgba(12,14,26,.9), rgba(10,12,22,.86));
  border: 1px solid rgba(157,117,255,.35);
  box-shadow:
    0 0 0 1px rgba(132, 98, 255, .1) inset,
    0 16px 40px rgba(98, 66, 255, .18);
  backdrop-filter: blur(6px);
}
.chatbox.is-busy{ opacity: .98 }

.chatbox-input{
  position: relative;
  z-index: 2;
  height: 46px;
  border: 0;
  outline: 0;
  width: 100%;
  background: transparent;
  color: var(--text, #dfe6ff);
  font-size: 16px;
}
.chatbox-input::placeholder{ color: #778; }

.chatbox-actions{
  display: flex; gap: 10px; align-items: center;
}
.cb-btn{
  border: 0; outline: 0; cursor: pointer;
  height: 42px; padding: 0 18px;
  border-radius: 24px;
  color: #efeaff;
  background: linear-gradient(180deg,#7d51ff,#6a3dff 70%);
  box-shadow: 0 10px 24px rgba(122,72,255,.34), 0 0 0 1px rgba(150,100,255,.2) inset;
}
.cb-btn:disabled { opacity: .55; cursor: default; }

/* ----- Waves container (inside bar) ----- */
.cb-waves{
  position: absolute;
  left: 18px;
  right: 170px;        /* space for the buttons */
  top: 8px;
  height: 42px;
  z-index: 1;
  pointer-events: none;
  overflow: hidden;
}
.cb-waves-svg{ width: 100%; height: 100%; }

.cb-fog{
  fill: radial-gradient(circle at 50% 50%, #ffdf6e 0%, transparent 70%); /* overridden by fill below */
  fill: #ffd24d;
  opacity: .10;
  filter: blur(6px);
}

.cb-wave{
  fill: none;
  stroke-width: 2;
  filter: drop-shadow(0 0 8px rgba(120,80,255,.35));
}
.cb-wave.wave-a{ stroke: #8b5cff; }
.cb-wave.wave-b{ stroke: #00e0ff; opacity: .9; }
.cb-wave.wave-c{ stroke: #ff53d4; opacity: .85; }

/* Status tints & persistent glow */
.chatbox.typing .cb-wave      { filter: drop-shadow(0 0 7px rgba(0,224,255,.22)); }
.chatbox.listening .cb-wave   { filter: drop-shadow(0 0 10px rgba(0,224,255,.35)); }
.chatbox.transcribing .cb-wave{ filter: drop-shadow(0 0 10px rgba(255, 83,212,.32)); }
.chatbox.thinking .cb-wave    { filter: drop-shadow(0 0 8px rgba(139,92,255,.28)); }
.chatbox.speaking .cb-wave    { filter: drop-shadow(0 0 12px rgba(255, 83,212,.38)); }
.chatbox.idle .cb-wave        { opacity: .75; }

/* Tight layout on small screens */
@media (max-width: 720px){
  .chatbox{ grid-template-columns: 1fr auto; padding-right: 10px; }
  .cb-waves{ right: 150px; }
}
/* Hide waves by default; only show for these states */
.cb-waves{ opacity: 0; transition: opacity .25s ease }
.chatbox.listening .cb-waves,
.chatbox.transcribing .cb-waves,
.chatbox.thinking .cb-waves,
.chatbox.speaking .cb-waves { opacity: 1; }
/* ===== Stage-wide listening/transcribing/thinking overlay (full chat area) ===== */
.stage{
  position: relative;
  flex: 1;
  min-height: 280px;
  display: flex;
  flex-direction: column;
}
.stage .messages{
  position: relative;
  z-index: 1;
  transition: filter .25s var(--ease), opacity .25s var(--ease);
}
.stage .messages.is-covered{
  filter: blur(4px);
  opacity: .08;
  pointer-events: none;
}

.stage-waves{
  position: absolute;
  inset: 0 0 86px 0;          /* leave space for the bottom composer */
  z-index: 2;
  pointer-events: none;
  opacity: 0;
  transition: opacity .25s var(--ease);
  background: radial-gradient(1200px 600px at 50% 100%, rgba(122,62,255,.10), transparent 60%),
              radial-gradient(1200px 600px at 50%   0%, rgba(0,229,255,.06), transparent 60%);
  backdrop-filter: blur(2px) saturate(1.02);
}
.stage-waves.show{ opacity: 1; }

.stage-waves-svg{ width: 100%; height: 100%; }

/* Fog + three layered strokes (match chatbox palette) */
.stage-fog{
  fill: #ffd24d;     /* warm hint; tinted by state below */
  opacity: .08;
  filter: blur(10px);
}
.stage-wave{
  fill: none;
  stroke-width: 3;
  filter: drop-shadow(0 0 10px rgba(120,80,255,.28));
}
.stage-wave.wave-a{ stroke: #8b5cff; }
.stage-wave.wave-b{ stroke: #00e0ff; opacity: .95; }
.stage-wave.wave-c{ stroke: #ff53d4; opacity: .85; }

/* State tints */
.stage-waves.listening .stage-wave { filter: drop-shadow(0 0 12px rgba(0,224,255,.35)); }
.stage-waves.transcribing .stage-wave { filter: drop-shadow(0 0 12px rgba(255,83,212,.34)); }
.stage-waves.thinking .stage-wave { filter: drop-shadow(0 0 10px rgba(139,92,255,.28)); }
.stage-waves.speaking .stage-wave { filter: drop-shadow(0 0 14px rgba(255,83,212,.40)); }

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce){
  .stage .messages.is-covered{ filter: none; opacity: .20; }
  .stage-waves{ background: linear-gradient(180deg, rgba(122,62,255,.10), rgba(0,229,255,.08)); }
}
/* ===== ChatBox: full-bar Listening visuals ===== */
.listen-glow{
  position:absolute; inset:-20% -10%;
  background:
    radial-gradient(120% 140% at 15% 50%, rgba(0,229,255,.20), transparent 60%),
    radial-gradient(120% 140% at 85% 50%, rgba(255,83,212,.14), transparent 60%),
    linear-gradient(90deg, rgba(139,92,255,.10), rgba(0,229,255,.10), rgba(139,92,255,.10));
  filter: blur(12px) saturate(1.05);
  animation: listen-breathe 3.4s ease-in-out infinite;
}
@keyframes listen-breathe{
  0%,100%{ transform: scale(1); opacity:.85 }
  50%    { transform: scale(1.03); opacity:1 }
}

.listen-scan{
  position:absolute; top:-8%; bottom:-8%; width:28%;
  background: linear-gradient(90deg,
    rgba(0,0,0,0) 0%,
    rgba(0,229,255,.0) 2%,
    rgba(0,229,255,.22) 30%,
    rgba(255,210,77,.28) 50%,
    rgba(255,83,212,.22) 70%,
    rgba(0,229,255,.0) 98%,
    rgba(0,0,0,0) 100%);
  filter: blur(2px) saturate(1.1);
  animation: listen-scan 2.6s linear infinite;
  mix-blend-mode: screen;
}
@keyframes listen-scan{
  from { transform: translateX(-40%) }
  to   { transform: translateX(140%) }
}

/* Optional: a subtle inset outline while listening */
.chatbox.listening{
  box-shadow: inset 0 0 0 1px rgba(0,229,255,.18), 0 0 24px rgba(122,62,255,.18);
}
